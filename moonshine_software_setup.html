
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>6. MoonShineP: Software setup &#8212; MoonShine Instruction Manual</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="7. MoonShineP: Calibration" href="moonshine_calibration.html" />
    <link rel="prev" title="5. MoonShineP: Hardware setup" href="moonshine_hardware_setup.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">MoonShine Instruction Manual</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="overview.html">
                    Updated Sep 21, 2023
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="lux_calculator.html">
   1.
   <span style="font-variant:small-caps;">
    MoonShineR
   </span>
   : R package
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="moonlight_LED_scheduler.html">
   2.
   <span style="font-variant:small-caps;">
    MoonShineR
   </span>
   : Moonlight scheduler
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="sunlight_twilight_LED_scheduler.html">
   3.
   <span style="font-variant:small-caps;">
    MoonShineR
   </span>
   : Sunlight/twilight scheduler
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="edit_LED_schedule_csv.html">
   4. Edit LED schedule
   <code class="docutils literal notranslate">
    <span class="pre">
     .csv
    </span>
   </code>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="moonshine_hardware_setup.html">
   5.
   <span style="font-variant:small-caps;">
    MoonShineP
   </span>
   : Hardware setup
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   6.
   <span style="font-variant:small-caps;">
    MoonShineP
   </span>
   : Software setup
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="moonshine_calibration.html">
   7.
   <span style="font-variant:small-caps;">
    MoonShineP
   </span>
   : Calibration
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="moonshine_launch_procedure.html">
   8.
   <span style="font-variant:small-caps;">
    MoonShineP
   </span>
   : Launch procedure
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="download.html">
   Download files
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="reference.html">
   References
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/Crampton-Lab/MoonShine/master?urlpath=tree/docs/moonshine_software_setup.md"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/Crampton-Lab/MoonShine"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/Crampton-Lab/MoonShine/issues/new?title=Issue%20on%20page%20%2Fmoonshine_software_setup.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="_sources/moonshine_software_setup.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download notebook file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-code"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        <a href="_sources/moonshine_software_setup.md"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.md</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#setting-up-a-new-raspberry-pi">
   Setting up a new Raspberry Pi
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#setup-real-time-clock-rtc-and-time">
   Setup real time clock (RTC) and time
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#desktop-folders">
   Desktop folders
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#setting-up-systemd-service">
   Setting up systemd service
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#setting-led-numbers-in-moonshine-moon-py-and-moonshine-sun-py">
   Setting LED numbers in
   <code class="docutils literal notranslate">
    <span class="pre">
     moonshine_moon.py
    </span>
   </code>
   and
   <code class="docutils literal notranslate">
    <span class="pre">
     moonshine_sun.py
    </span>
   </code>
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>6. <span style="font-variant:small-caps;">MoonShineP</span>: Software setup</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#setting-up-a-new-raspberry-pi">
   Setting up a new Raspberry Pi
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#setup-real-time-clock-rtc-and-time">
   Setup real time clock (RTC) and time
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#desktop-folders">
   Desktop folders
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#setting-up-systemd-service">
   Setting up systemd service
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#setting-led-numbers-in-moonshine-moon-py-and-moonshine-sun-py">
   Setting LED numbers in
   <code class="docutils literal notranslate">
    <span class="pre">
     moonshine_moon.py
    </span>
   </code>
   and
   <code class="docutils literal notranslate">
    <span class="pre">
     moonshine_sun.py
    </span>
   </code>
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="span-style-font-variant-small-caps-moonshinep-span-software-setup">
<span id="content-lightbox-software"></span><h1>6. <span style="font-variant:small-caps;">MoonShineP</span>: Software setup<a class="headerlink" href="#span-style-font-variant-small-caps-moonshinep-span-software-setup" title="Permalink to this headline">#</a></h1>
<section id="setting-up-a-new-raspberry-pi">
<span id="content-lightbox-lednumber"></span><h2>Setting up a new Raspberry Pi<a class="headerlink" href="#setting-up-a-new-raspberry-pi" title="Permalink to this headline">#</a></h2>
<ol>
<li><p>On a computer go to the Raspberry Pi website <a class="reference external" href="https://www.raspberrypi.com/software/">https://www.raspberrypi.com/software/</a> to download and install the Raspberry Pi Imager.</p></li>
<li><p>In the Raspberry Pi Imager, install <strong>Raspberry Pi OS (Legacy)</strong> on the micro SD card.</p></li>
<li><p>Connect the monitor, keyboard, and mouse to the Raspberry Pi.</p></li>
<li><p>Insert the micro SD card into the Raspberry Pi.</p></li>
<li><p>Connect power to the Raspberry Pi to boot it up.</p></li>
<li><p>Follow the instructions in the setup pages. Connect to the internet, and perform the prompted update on first launch. Note down the username and password that are utilized.</p></li>
<li><p>Install Python 3.9.9.</p>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>MoonShineP DOES NOT SUPPORT OTHER VERSIONS OF PYTHON</p>
</div>
<p>Reference: <a class="reference external" href="https://linuxhint.com/update-python-raspberry-pi/">How to Update Python on Raspberry Pi</a></p>
<p>Enter the following sequence of commands in the terminal:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">wget</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">python</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">ftp</span><span class="o">/</span><span class="n">python</span><span class="o">/</span><span class="mf">3.9.9</span><span class="o">/</span><span class="n">Python</span><span class="o">-</span><span class="mf">3.9.9</span><span class="o">.</span><span class="n">tgz</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tar</span> <span class="o">-</span><span class="n">zxvf</span> <span class="n">Python</span><span class="o">-</span><span class="mf">3.9.9</span><span class="o">.</span><span class="n">tgz</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">Python</span><span class="o">-</span><span class="mf">3.9.9</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">configure</span> <span class="o">--</span><span class="n">enable</span><span class="o">-</span><span class="n">optimizations</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">make</span> <span class="n">altinstall</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="nb">bin</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">rm</span> <span class="n">python</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">ln</span> <span class="o">-</span><span class="n">s</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">python3</span><span class="mf">.9</span> <span class="n">python</span>
</pre></div>
</div>
</li>
<li><p>Check Python version is version (3.9.9) by entering:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">--</span><span class="n">version</span>
</pre></div>
</div>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>It must be Python 3.9.9</p>
</div>
</li>
<li><p>Reboot the Raspberry Pi.</p></li>
<li><p>Modify the Raspberry Pi to run the ws2811 library.</p></li>
</ol>
<p>Reference: <a class="reference external" href="https://tutorials-raspberrypi.com/connect-control-raspberry-pi-ws2812-rgb-led-strips/">Connect and Control WS2812 RGB LED Strips via Raspberry Pi</a></p>
<ul class="simple">
<li><p>In terminal, enter the following sequence of commands:</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">update</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">gcc</span> <span class="n">make</span> <span class="n">build</span><span class="o">-</span><span class="n">essential</span> <span class="n">python</span><span class="o">-</span><span class="n">dev</span> <span class="n">git</span> <span class="n">scons</span> <span class="n">swig</span>
</pre></div>
</div>
<ul>
<li><p>Confirm with Y</p></li>
<li><p>This following command line will open a file editor. To deactivate audio output, edit the <code class="docutils literal notranslate"><span class="pre">.conf</span></code> file by entering the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">nano</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">modprobe</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">snd</span><span class="o">-</span><span class="n">blacklist</span><span class="o">.</span><span class="n">conf</span>
</pre></div>
</div>
</li>
<li><p>A new terminal window will open. In this window add the following line text:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">blacklist</span> <span class="n">snd_bcm2835</span>
</pre></div>
</div>
</li>
<li><p>Then save file with CTRL + O.</p></li>
<li><p>And close the editor with CTRL + X.</p></li>
<li><p>We also need to edit another file. To do so, enter:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">nano</span> <span class="o">/</span><span class="n">boot</span><span class="o">/</span><span class="n">config</span><span class="o">.</span><span class="n">txt</span>
</pre></div>
</div>
</li>
<li><p>When the editor is opened, comment out the following line with a # at the beginning:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dtparam</span><span class="o">=</span><span class="n">audio</span><span class="o">=</span><span class="n">on</span>
</pre></div>
</div>
<p>i.e.,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#dtparam=audio=on</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Then save file with CTRL + O.</p></li>
<li><p>And close the editor with CTRL + X.</p></li>
</ul>
</li>
<li><p>Reboot the Raspberry Pi by entering:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">reboot</span>
</pre></div>
</div>
</li>
</ul>
<ol>
<li><p>Download rpi_ws281x library by entering:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">jgarff</span><span class="o">/</span><span class="n">rpi_ws281x</span>
</pre></div>
</div>
</li>
<li><p>Next, modify the following lines to specify using the SK6812 protocol:</p>
<ul class="simple">
<li><p>Using the file explorer, open the <code class="docutils literal notranslate"><span class="pre">main.c</span></code> file found in <em>/home/pi/rpi_ws281x/</em></p></li>
<li><p>The line of “STRIP_TYPE  WS2811_STRIP_RGB” is turned on by default for LED ws2811 (should be Line 63), so turn it off by adding // at the beginning of the line.</p></li>
<li><p>Instead, turn on the line of “STRIP_TYPE  WS6812_STRIP_RGBW” (should be line 64) for SK6812 by deleting the // at the beginning of the line.</p></li>
<li><p>On the line beginning with <em>‘define HEIGHT’</em> (should be line 67) edit the number to 1.</p></li>
<li><p>The value of the line beginning with <em>‘define WIDTH’</em> is unimportant and should be left at its default (should be line 66). This is because it is expected that the user will use a different number of LED strips for the moonlight array (two LED strip should suffice) and sunlight/twilight array (likely need more than two LED strips). The different number of LEDs being used for the two arrays are specified in the python file <code class="docutils literal notranslate"><span class="pre">moonshine_moon.py</span></code> and <code class="docutils literal notranslate"><span class="pre">moonshine_sun.py</span></code>, detailed later.</p></li>
<li><p>Save file.</p></li>
</ul>
<figure class="align-default" id="mainc">
<img alt="_images/mainc.png" src="_images/mainc.png" />
<figcaption>
<p><span class="caption-number">Fig. 34 </span><span class="caption-text">The configuration of the <code class="docutils literal notranslate"><span class="pre">main.c</span></code> file.</span><a class="headerlink" href="#mainc" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
</li>
<li><p>Next, compile the library for Python.</p>
<p>In terminal, enter the following commands:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">rpi_ws281x</span><span class="o">/</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">scons</span>
</pre></div>
</div>
</li>
<li><p>Now the Raspberry Pi should be ready to control the SK6812 LED strips.</p></li>
</ol>
</section>
<section id="setup-real-time-clock-rtc-and-time">
<h2>Setup real time clock (RTC) and time<a class="headerlink" href="#setup-real-time-clock-rtc-and-time" title="Permalink to this headline">#</a></h2>
<p>A real time clock module is optional but recommended. We recommend that the user runs the Raspberry Pi offline, and instead uses the RTC to keep time. This is because when the Raspberry Pi is online it will automatically update to the local time. This may use daylight saving time, DST, which can be troublesome. The RTC is also essential if the Raspberry Pi is used in a location with no internet connection.</p>
<ol>
<li><p>Install RTC module DS3231 as described in <a class="reference internal" href="moonshine_hardware_setup.html#content-hardware-assemble"><span class="std std-ref">Assemble Raspberry Pi and LED strips</span></a>.</p></li>
<li><p>On the task bar of the main Linux window of Raspberry Pi, go to the Start menu (top left button) and enable the RTC module by selecting the following options: &gt; Preferences &gt; Raspberry Pi Configuration &gt; Interfaces &gt; I2C <strong>Enable</strong> &gt; OK</p></li>
<li><p>Install RTC configurations (see video reference: <a class="reference external" href="https://www.youtube.com/watch?v=MxUbqotDBnM">Real Time Clock Script for Raspberry Pi</a>, and this online tutorial: <a class="reference external" href="https://thepihut.com/blogs/raspberry-pi-tutorials/17209332-adding-a-real-time-clock-to-your-raspberry-pi">Adding a Real Rime Clock to your Raspberry Pi</a>)</p>
<ul class="simple">
<li><p>In terminal enter:</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">wget</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">raw</span><span class="o">.</span><span class="n">githubusercontent</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">km4ack</span><span class="o">/</span><span class="n">pi</span><span class="o">-</span><span class="n">scripts</span><span class="o">/</span><span class="n">master</span><span class="o">/</span><span class="n">rtc</span> <span class="o">&amp;&amp;</span> <span class="n">bash</span> <span class="n">rtc</span>
</pre></div>
</div>
<ul class="simple">
<li><p>When the terminal returns: “Is the time above correct?”, respond accordingly (Y/N).</p></li>
<li><p>When the terminal returns: “Do you see 68 in the info listed above?”, respond accordingly (Y/N). (Note to user: you may see UU instead of 68)</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This rtc installation works for both DS 1307 or DS 3231 RTC chips</p>
</div>
</li>
<li><p>Turn off DST by setting the time zone to UTC. In terminal, enter:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">raspi</span><span class="o">-</span><span class="n">config</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Select option 5 <strong>Internationalization Options</strong></p></li>
<li><p>Select 12 <strong>Change Time Zone</strong></p></li>
<li><p>At the bottom select <strong>None of the above</strong></p></li>
<li><p>Select <strong>UTC</strong> and OK</p></li>
</ul>
</li>
<li><p>Change Raspberry Pi’s clock to the user’s current time (without DST, even if the user is currently experiencing DST), by entering into the terminal terminal:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">date</span> <span class="o">-</span><span class="n">s</span> <span class="s1">&#39;YYYY-MM-DD hh:mm:ss&#39;</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Change the above to the user’s current time, for example ‘2022-01-01 01:01:00’.</p></li>
</ul>
</li>
<li><p>Copy the time from the Raspberry Pi system to the Hardware RTC by entering:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">hwclock</span> <span class="o">-</span><span class="n">w</span>
</pre></div>
</div>
</li>
<li><p>To check if RTC is working, enter:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">hwclock</span> <span class="o">-</span><span class="n">rv</span>
</pre></div>
</div>
<ul class="simple">
<li><p>The RTC time will be reported.</p></li>
</ul>
</li>
</ol>
</section>
<section id="desktop-folders">
<span id="content-lightbox-lednumber2"></span><h2>Desktop folders<a class="headerlink" href="#desktop-folders" title="Permalink to this headline">#</a></h2>
<ol>
<li><p>Download the <em>control_moon</em> and <em>control_sun</em> folders (download in <a class="reference internal" href="download.html#content-lightbox-download"><span class="std std-ref">Download files</span></a>).</p>
<ul class="simple">
<li><p><em>control_moon</em> contains <code class="docutils literal notranslate"><span class="pre">moonshine_moon.py</span></code></p></li>
<li><p><em>control_sun</em> contains <code class="docutils literal notranslate"><span class="pre">moonshine_sun.py</span></code></p></li>
</ul>
</li>
<li><p>Move the two folders to the Raspberry Pi Desktop.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In  <code class="docutils literal notranslate"><span class="pre">moonshine_moon.py</span></code>, the line of LED_PIN = 18 specifies the communication with the moonlight LED strip through the <strong>GPIO 18</strong>. In <code class="docutils literal notranslate"><span class="pre">moonshine_sun.py</span></code>, the line of LED_PIN = 21 controls the sunlight/twilight LED strip through <strong>GPIO 21</strong> instead.</p>
</div>
</li>
<li><p>In additional, download <code class="docutils literal notranslate"><span class="pre">clear_moon.py</span></code> and <code class="docutils literal notranslate"><span class="pre">clear_sun.py</span></code> put them directly on the Raspberry Pi Desktop.</p></li>
</ol>
</section>
<section id="setting-up-systemd-service">
<span id="content-systemd"></span><h2>Setting up systemd service<a class="headerlink" href="#setting-up-systemd-service" title="Permalink to this headline">#</a></h2>
<p>Running <em><span style="font-variant:small-caps;">MoonShineP</span></em> using the Linux systemd service manager allows it to recover and resume light re-creation automatically, in the unlikely event of a crash.</p>
<ol>
<li><p>Create a new service file.</p>
<p>In terminal, enter:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">nano</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">systemd</span><span class="o">/</span><span class="n">system</span><span class="o">/</span><span class="n">moonshine_moon</span><span class="o">.</span><span class="n">service</span>
</pre></div>
</div>
</li>
<li><p>The file editor will open up a blank file, paste in the following lines:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">Unit</span><span class="p">]</span>
<span class="n">Description</span><span class="o">=</span><span class="n">relaunch</span> <span class="n">moonshine_moon</span><span class="o">.</span><span class="n">py</span> <span class="n">when</span> <span class="n">crashed</span>

<span class="p">[</span><span class="n">Service</span><span class="p">]</span>
<span class="n">User</span><span class="o">=</span><span class="n">root</span>
<span class="n">Group</span><span class="o">=</span><span class="n">root</span>
<span class="n">Type</span><span class="o">=</span><span class="n">shineple</span>
<span class="n">ExecStart</span><span class="o">=</span><span class="n">sudo</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">python3</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">pi</span><span class="o">/</span><span class="n">Desktop</span><span class="o">/</span><span class="n">control_moon</span><span class="o">/</span><span class="n">moonshine_moon</span><span class="o">.</span><span class="n">py</span>
<span class="n">Restart</span><span class="o">=</span><span class="n">always</span>
<span class="n">RestartSec</span><span class="o">=</span><span class="mi">3</span>

<span class="p">[</span><span class="n">Install</span><span class="p">]</span>
<span class="n">WantedBy</span><span class="o">=</span><span class="n">default</span><span class="o">.</span><span class="n">target</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The line of “ExecStart=…” instructs system service to locate the <span style="font-variant:small-caps;">MoonShineP</span> python script in the correct directory. Restart=always and RestartSec=3 are configured to restart <code class="docutils literal notranslate"><span class="pre">moonshine_moon.py</span></code> within 3 seconds upon closing (i.e., the script crashing).</p>
</div>
</li>
<li><p>Then save file with CTRL + O. CTRL + X to close the editor.</p>
<p>When prompted for the file name, confirm that it is <code class="docutils literal notranslate"><span class="pre">moonshine_moon.service</span></code> and save.</p>
</li>
<li><p>Refresh the system service files. It may ask for the username and password (if so enter the username and password). Enter in terminal:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">systemctl</span> <span class="n">daemon</span><span class="o">-</span><span class="n">reload</span>
</pre></div>
</div>
</li>
<li><p>(Optional) If the user is recreating sunlight and twilight as well, repeat the above steps, from 1 to 4, to make another service for <em>control_sun/moonshine_sun.py</em></p>
<ul>
<li><p>For step 1, use a different file name:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">nano</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">systemd</span><span class="o">/</span><span class="n">system</span><span class="o">/</span><span class="n">moonshine_sun</span><span class="o">.</span><span class="n">service</span>
</pre></div>
</div>
</li>
<li><p>For step 2, replace the line of <code class="docutils literal notranslate"><span class="pre">ExecStart=...</span></code>  with</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ExecStart</span><span class="o">=</span><span class="n">sudo</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">python3</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">pi</span><span class="o">/</span><span class="n">Desktop</span><span class="o">/</span><span class="n">control_sun</span><span class="o">/</span><span class="n">moonshine_sun</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
</li>
<li><p>For step 3, save the file with name <code class="docutils literal notranslate"><span class="pre">moonshine_sun.service</span></code></p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Every time a <code class="docutils literal notranslate"><span class="pre">.service</span></code> file is edited, it requires a refresh (see Step 4).</p>
</div>
</li>
</ol>
</section>
<section id="setting-led-numbers-in-moonshine-moon-py-and-moonshine-sun-py">
<span id="content-lightbox-lednumber3"></span><h2>Setting LED numbers in <code class="docutils literal notranslate"><span class="pre">moonshine_moon.py</span></code> and <code class="docutils literal notranslate"><span class="pre">moonshine_sun.py</span></code><a class="headerlink" href="#setting-led-numbers-in-moonshine-moon-py-and-moonshine-sun-py" title="Permalink to this headline">#</a></h2>
<ul class="simple">
<li><p>Recall that in <a class="reference internal" href="moonlight_LED_scheduler.html#content-moonshiner-moon"><span class="std std-ref">2. MoonShineR: Moonlight scheduler</span></a> and <a class="reference internal" href="sunlight_twilight_LED_scheduler.html#content-moonshiner-sun"><span class="std std-ref">3. MoonShineR: Sunlight/twilight scheduler</span></a>, the user was required to enter the specifications of the LED array (diode_per_strip and strip_count) into the R program. This was essential for generating the schedule <code class="docutils literal notranslate"><span class="pre">.csv</span></code>. It is important that LED_COUNT (below) in <em><span style="font-variant:small-caps;">MoonShineP</span></em> python script represents the product of diode_per_strip (from <em><span style="font-variant:small-caps;">MoonShineR</span></em>) and strip_count (from <em><span style="font-variant:small-caps;">MoonShineR</span></em>).</p></li>
</ul>
<ol>
<li><p>To calculate the total number of LEDs, diode_per_strip should be multiplied by strip_count. E.g., 144 x 4 = 576.</p></li>
<li><p>Edit the line of “LED_COUNT” in <code class="docutils literal notranslate"><span class="pre">moonshine_moon.py</span></code> and <code class="docutils literal notranslate"><span class="pre">moonshine_sun.py</span></code> with the respective total number of LEDs for each array (see <a class="reference internal" href="#led-count"><span class="std std-numref">Fig. 35</span></a>).</p>
<figure class="align-default" id="led-count">
<img alt="_images/led_count.png" src="_images/led_count.png" />
<figcaption>
<p><span class="caption-number">Fig. 35 </span><span class="caption-text">Specify the line of “LED_COUNT” in <code class="docutils literal notranslate"><span class="pre">moonshine_sun.py</span></code> to 576 when using four daisy-chained 144 LED strips.</span><a class="headerlink" href="#led-count" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
</li>
<li><p>Save the file.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When changing the number of LEDs number in an array, change the corresponding settings in <span style="font-variant:small-caps;">MoonShineR</span> schedulers and the <span style="font-variant:small-caps;">MoonShineP</span> python file. This will, of course, also require a recalibration of the illuminance.</p>
</div>
</li>
</ol>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="moonshine_hardware_setup.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">5. <span style="font-variant:small-caps;">MoonShineP</span>: Hardware setup</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="moonshine_calibration.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">7. <span style="font-variant:small-caps;">MoonShineP</span>: Calibration</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By C. Lok Poon, Ian T. Jenks & W.G.R., Crampton. University of Central Florida.<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>