
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>MoonShine: Software setup &#8212; MoonSim and MoonShine Documentation</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="MoonShine: Calibration" href="moonshine_calibration.html" />
    <link rel="prev" title="MoonShine: Hardware setup" href="moonshine_hardware_setup.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">MoonSim and MoonShine Documentation</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="overview.html">
                    Overview
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="moonsim_lux_calculator.html">
   <span style="font-variant:small-caps;">
    MoonSim
   </span>
   : Lux calculator
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="moonsim_moonlight_LED_scheduler.html">
   <span style="font-variant:small-caps;">
    MoonSim
   </span>
   : Moonlight scheduler
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="moonsim_sunlight_twilight_LED_scheduler.html">
   <span style="font-variant:small-caps;">
    MoonSim
   </span>
   : Sunlight &amp; twilight scheduler
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="edit_LED_schedule_csv.html">
   Edit
   <span style="font-variant:small-caps;">
    MoonSim
   </span>
   schedule
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="moonshine_hardware_setup.html">
   <span style="font-variant:small-caps;">
    MoonShine
   </span>
   : Hardware setup
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   <span style="font-variant:small-caps;">
    MoonShine
   </span>
   : Software setup
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="moonshine_calibration.html">
   <span style="font-variant:small-caps;">
    MoonShine
   </span>
   : Calibration
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="moonshine_launch_procedure.html">
   <span style="font-variant:small-caps;">
    MoonShine
   </span>
   : Launch procedure
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="moonlight_variation.html">
   Description of moonlight variation
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/lokpoon/LunaSim/master?urlpath=tree/docs/moonshine_software_setup.md"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/lokpoon/LunaSim"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/lokpoon/LunaSim/issues/new?title=Issue%20on%20page%20%2Fmoonshine_software_setup.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="_sources/moonshine_software_setup.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download notebook file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-code"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        <a href="_sources/moonshine_software_setup.md"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.md</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#setting-up-a-new-raspberry-pi">
   Setting up a new Raspberry Pi
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#setup-rtc-and-time">
   Setup RTC and time
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#desktop-folders">
   Desktop folders
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#setting-up-systemd-service">
   Setting up systemd service
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1><span style="font-variant:small-caps;">MoonShine</span>: Software setup</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#setting-up-a-new-raspberry-pi">
   Setting up a new Raspberry Pi
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#setup-rtc-and-time">
   Setup RTC and time
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#desktop-folders">
   Desktop folders
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#setting-up-systemd-service">
   Setting up systemd service
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="span-style-font-variant-small-caps-moonshine-span-software-setup">
<span id="content-lightbox-software"></span><h1><span style="font-variant:small-caps;">MoonShine</span>: Software setup<a class="headerlink" href="#span-style-font-variant-small-caps-moonshine-span-software-setup" title="Permalink to this headline">#</a></h1>
<section id="setting-up-a-new-raspberry-pi">
<span id="content-lightbox-lednumber"></span><h2>Setting up a new Raspberry Pi<a class="headerlink" href="#setting-up-a-new-raspberry-pi" title="Permalink to this headline">#</a></h2>
<ol>
<li><p>On a computer go to Raspberry Pi’s website <a class="reference external" href="https://www.raspberrypi.com/software/">https://www.raspberrypi.com/software/</a> to download and install the Raspberry Pi Imager.</p></li>
<li><p>In Raspberry Pi Imager, install <strong>Raspberry Pi OS (Legacy)</strong> on the micro SD card.</p></li>
<li><p>Connect the monitor, keyboard, and mouse to the PI.</p></li>
<li><p>Insert the micro SD card into the Pi.</p></li>
<li><p>Connect power to the Pi to boot it up.</p></li>
<li><p>Follow the setup pages instructions. Connect to the internet, and the perform prompted update on first launch. Note down the username and password being set.</p></li>
<li><p>Install Python 3.9.9.</p>
<p>Reference: <a class="reference external" href="https://linuxhint.com/update-python-raspberry-pi/">How to Update Python on Raspberry Pi</a></p>
<p>Enter the following sequence of commands in terminal:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">wget</span> <span class="pre">https://www.python.org/ftp/python/3.9.9/Python-3.9.9.tgz</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tar</span> <span class="pre">-zxvf</span> <span class="pre">Python-3.9.9.tgz</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">Python-3.9.9</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">./configure</span> <span class="pre">--enable-optimizations</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">make</span> <span class="pre">altinstall</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">/usr/bin</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">rm</span> <span class="pre">python</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">ln</span> <span class="pre">-s</span> <span class="pre">/usr/local/bin/python3.9</span> <span class="pre">python</span></code></p></li>
</ul>
</li>
<li><p>Check Python version (3.9.9):</p>
<p><code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">--version</span></code></p>
</li>
<li><p>Modify Pi to run the <em>ws2811</em> library.</p>
<p>Reference: <a class="reference external" href="https://tutorials-raspberrypi.com/connect-control-raspberry-pi-ws2812-rgb-led-strips/">Connect and Control WS2812 RGB LED Strips via Raspberry Pi</a></p>
<p>In terminal:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">apt-get</span> <span class="pre">update</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">apt-get</span> <span class="pre">install</span> <span class="pre">gcc</span> <span class="pre">make</span> <span class="pre">build-essential</span> <span class="pre">python-dev</span> <span class="pre">git</span> <span class="pre">scons</span> <span class="pre">swig</span></code> (confirm with Y)</p></li>
<li><p>This command line will open a file editor. To deactivate audio output, we edit the <code class="docutils literal notranslate"><span class="pre">.conf</span></code> file by:</p>
<p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">nano</span> <span class="pre">/etc/modprobe.d/snd-blacklist.conf</span></code></p>
<p>And add this line:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">blacklist</span> <span class="n">snd_bcm2835</span>
</pre></div>
</div>
<p>Then save file with CTRL + O.</p>
<p>And close the editor with CTRL + X.</p>
</li>
<li><p>Edit another <code class="docutils literal notranslate"><span class="pre">.conf</span></code> file:</p>
<p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">nano</span> <span class="pre">/boot/config.txt</span></code></p>
<p>Comment out the line</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dtparam</span><span class="o">=</span><span class="n">audio</span><span class="o">=</span><span class="n">on</span>
</pre></div>
</div>
<p>by adding a # in front of it.</p>
<p>Then save file with CTRL + O.</p>
<p>And close the editor with CTRL + X.</p>
</li>
<li><p>Reboot Pi:</p>
<p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">reboot</span></code></p>
</li>
</ul>
</li>
<li><p>Download <em>rpi_ws281x</em> library</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">cd</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">clone</span> <span class="pre">https://github.com/jgarff/rpi_ws281x</span></code></p></li>
</ul>
</li>
<li><p>We need to modify some lines to specify using SK6812:</p>
<ul>
<li><p>Using the file explorer, open the <code class="docutils literal notranslate"><span class="pre">main.c</span></code> file found in <em>/home/pi/rpi_ws281x/</em></p></li>
<li><p>Line 63 is turned on by default for LED ws2811, so turn it off by adding // at the front.</p></li>
<li><p>Instead, turn on line 64 for SK6812 by deleting the // at the front.</p></li>
<li><p>On line 66, edit it to the number of total numbers of LEDs connected.</p></li>
<li><p>On line 67, edit number to 1.</p></li>
<li><p>Save file.</p></li>
<li><p>Then we compile the library for Python.</p>
<p>In terminal:</p>
<p><code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">rpi_ws281x/</span></code></p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">scons</span></code></p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Everytime main.c is edited, for example changing the number LED connected, it requires a recompile.</p>
</div>
</li>
<li><p>Now the Pi should be ready to control the SK6812 LED strips using our <code class="docutils literal notranslate"><span class="pre">lightbox.py</span></code></p></li>
</ol>
</section>
<section id="setup-rtc-and-time">
<h2>Setup RTC and time<a class="headerlink" href="#setup-rtc-and-time" title="Permalink to this headline">#</a></h2>
<p>A real time clock module is optional but recommended. We recommend the user to run the Pi offline, and instead use the RTC to keep time. This is because having the Pi connected to the internet may not be possible, and when the Pi is online it will automatically update to the local time (including the troublesome DST).</p>
<ol>
<li><p>Install RTC module DS3231 as described in <a class="reference internal" href="moonshine_hardware_setup.html#content-hardware-assemble"><span class="std std-ref">Assemble Pi and LED strips</span></a></p></li>
<li><p>On Pi, go to Start menu (top left button) &gt; Preferences &gt; Raspberry Pi Configuration &gt; Interfaces &gt; I2C <strong>Enable</strong> &gt; OK</p></li>
<li><p>Install RTC configurations (Reference: <a class="reference external" href="https://www.youtube.com/watch?v=MxUbqotDBnM">Real Time Clock Script for Raspberry Pi</a>, <a class="reference external" href="https://thepihut.com/blogs/raspberry-pi-tutorials/17209332-adding-a-real-time-clock-to-your-raspberry-pi">Adding a Real Rime Clock to your Raspberry Pi</a>)</p>
<ul class="simple">
<li><p>In terminal:
`wget <a class="reference external" href="https://raw.githubusercontent.com/km4ack/pi-scripts/master/rtc">https://raw.githubusercontent.com/km4ack/pi-scripts/master/rtc</a> &amp;&amp; bash rtc’</p></li>
<li><p>Is the time above correct?</p></li>
<li><p>Do you see 68 in the info listed above? (It may also appear as UU instead of 68, either is fine)</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This rtc installation works for both DS 1307 or DS 3231 variants RTC chips</p>
</div>
</li>
<li><p>Turn off DST by setting the time zone to UTC. In terminal:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">raspi-config</span></code></p></li>
<li><p>Select option 5 <strong>Internationalization Options</strong></p></li>
<li><p>Select 12 <strong>Change Time Zone</strong></p></li>
<li><p>At the bottom select <strong>None of the above</strong></p></li>
<li><p>Select <strong>UTC</strong> and OK</p></li>
</ul>
</li>
<li><p>To change Pi clock to the user’s current time (without DST if the user is currently experiencing DST), in terminal:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">date</span> <span class="pre">-s</span> <span class="pre">'YYYY-MM-DD</span> <span class="pre">hh:mm:ss'</span></code></p></li>
<li><p>Change the above to the user’s current time in Year-Month-Day hour:minute:second. Keep the digits format, meaning four digits for the year and two digits for the rest.</p></li>
</ul>
</li>
<li><p>Copy the time from the Raspberry Pi system to the Hardware RTC:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">hwclock</span> <span class="pre">-w</span></code></p></li>
</ul>
</li>
<li><p>To check if RTC is working:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">hwclock</span> <span class="pre">-rv</span></code></p></li>
<li><p>It should report the RTC time.</p></li>
</ul>
</li>
</ol>
</section>
<section id="desktop-folders">
<span id="content-lightbox-lednumber2"></span><h2>Desktop folders<a class="headerlink" href="#desktop-folders" title="Permalink to this headline">#</a></h2>
<ol class="simple">
<li><p>Download from our Github. the <em>control_moon</em> and <em>control_sun</em> folders.</p></li>
<li><p>Move them to the Pi Desktop.</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In <em>/control_moon/moonsim_moon.py</em>, the line LED_PIN = 18 specify the communication with the LED strip through the <strong>GPIO 18</strong>. <em>/controlmoonsim_moonhtbox.py</em> controls controls through <strong>GPIO 21</strong> instead.</p>
</div>
</section>
<section id="setting-up-systemd-service">
<h2>Setting up systemd service<a class="headerlink" href="#setting-up-systemd-service" title="Permalink to this headline">#</a></h2>
<ol>
<li><p>Create a new service file.</p>
<p>In terminal:</p>
<p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">nano</span> <span class="pre">/etc/systemd/system/moonsim_moon.service</span></code></p>
</li>
<li><p>In the editor, paste in the following lines:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">Unit</span><span class="p">]</span>
<span class="n">Description</span><span class="o">=</span><span class="n">relaunch</span> <span class="n">moonsim_moon</span><span class="o">.</span><span class="n">py</span> <span class="n">when</span> <span class="n">crashed</span>

<span class="p">[</span><span class="n">Service</span><span class="p">]</span>
<span class="n">User</span><span class="o">=</span><span class="n">root</span>
<span class="n">Group</span><span class="o">=</span><span class="n">root</span>
<span class="n">Type</span><span class="o">=</span><span class="n">simple</span>
<span class="n">ExecStart</span><span class="o">=</span><span class="n">sudo</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">python3</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">pi</span><span class="o">/</span><span class="n">Desktop</span><span class="o">/</span><span class="n">control_moon</span><span class="o">/</span><span class="n">moonsim_moon</span><span class="o">.</span><span class="n">py</span>
<span class="n">Restart</span><span class="o">=</span><span class="n">always</span>
<span class="n">RestartSec</span><span class="o">=</span><span class="mi">3</span>

<span class="p">[</span><span class="n">Install</span><span class="p">]</span>
<span class="n">WantedBy</span><span class="o">=</span><span class="n">default</span><span class="o">.</span><span class="n">target</span>
</pre></div>
</div>
</li>
<li><p>Then save file with CTRL + O. CTRL + X to close the editor.</p>
<p>When prompted the file name, confirm that it is <code class="docutils literal notranslate"><span class="pre">moonsim_moon.service</span></code> and enter Y to save.</p>
</li>
<li><p>Refresh the system service files. It may ask for the username and password.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">systemctl</span> <span class="pre">daemon-reload</span></code></p></li>
</ul>
</li>
<li><p>(Optional) If the user is recreating sunlight and twilight as well, repeat the above steps to make another service for <em>control_sun/moonsim_sun.py</em></p>
<ul>
<li><p>For step 1, use a different file name:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">systemd</span><span class="o">/</span><span class="n">system</span><span class="o">/</span><span class="n">moonsim_sun</span><span class="o">.</span><span class="n">service</span>
</pre></div>
</div>
</li>
<li><p>For step 2, replace the line of ExecStart=…  with</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ExecStart</span><span class="o">=</span><span class="n">sudo</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">python3</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">pi</span><span class="o">/</span><span class="n">Desktop</span><span class="o">/</span><span class="n">control_sun</span><span class="o">/</span><span class="n">moonsim</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
</li>
<li><p>For step 3, save the file with name <code class="docutils literal notranslate"><span class="pre">moonsim_sun.service</span></code></p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Everytime a .service file is edited, it requires a refresh.</p>
</div>
</li>
</ol>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="moonshine_hardware_setup.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title"><span style="font-variant:small-caps;">MoonShine</span>: Hardware setup</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="moonshine_calibration.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span style="font-variant:small-caps;">MoonShine</span>: Calibration</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By C. Lok Poon<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>